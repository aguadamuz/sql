with taxonomic_tagged as -- these are petitions that have a taxonomic tag applied by a staff member and should be excluded from output for taggings
(select distinct petition_id, total_signature_count from
(
select e.id as petition_id, e.total_signature_count, tgs.tag_id as tag_id, t.name,
case when tgs.tag_id in (2695,6788,51764,45041,4571,51767,14050,16955,7442,4570,7600,7581,7367,8825,23444,7853,7291,6562,23452,7911,8431,23280,666, 25010,8396,8819,7845,5052,7622,3517,63,5053,7562,8250,9270,23488,8540,2397,311,65,47138,45053,7620,2407,17880,44549,23544, 22868,9024,2412,20891,7983,7414,7664,73,2352,9126,9160,4625,2361,32654,7582,7750,4109,7557,9271,20896,5644,7919,2473,7731, 8211,47630,8813,7331,23742,7002,8017,23396,20831,7636,6567,8035,21191,3680,7579,4108,64025,48665,7982,28370,7359,7525,4605, 8525, 8526, 7732, 6560, 6581, 22404, 60677, 45938, 8684, 45014, 7577, 7370, 3507, 22400, 8593, 3632, 7437, 23540, 22097, 2511, 30190, 7682, 2496, 26490, 7522, 2395, 8216, 23428, 7482, 7426, 2515, 12240, 2408, 2519, 53369, 7528, 7463, 6563, 38126, 6599, 74, 5643, 17885, 6600, 6601, 51797, 62237, 21171, 7635, 7666, 50, 7893, 900, 3269, 7837, 23311, 23420, 23416, 23412, 26018, 46877, 7514, 35210, 5650, 40088, 4793, 8384, 8538, 80, 3, 8839, 101, 4131, 2561, 2386, 5099, 2482, 45002, 7248, 9102, 2571, 8817, 7621, 7889, 14460, 7662, 6592, 8646, 2723, 48434, 45032, 9139, 7909, 23064, 9005, 7904, 8814, 24430, 10655, 30474, 9067, 2357, 9025, 17850, 9214, 46886, 46847, 46844, 6598, 8820, 7844, 18044, 19316, 21201, 3079, 17865, 8534, 4902, 4441, 23331, 9198, 6584, 53417, 4382, 23128, 7451, 39680, 8539, 2454, 21406, 3670, 2592, 7576, 2593, 45920, 8402, 2313, 8674, 2596, 8531, 53519, 35646, 51821, 51755, 45005, 4636, 45296, 8050, 93, 2359, 2538, 8541, 4527, 18891, 5174, 15600, 9838, 2621, 7811, 44537, 45026, 7903, 3959, 7328, 5292, 672, 8589, 4111, 57656, 2604, 8494, 2591, 2633, 3302, 7734, 4454, 23536, 59096, 5669, 7779, 7836, 9322, 26094, 45932, 6604, 6589, 6582, 4603, 56876, 4249, 23448, 4149, 23304, 23456, 23436, 8535, 7078, 33690, 6583, 6594, 7780, 23440, 5925, 6602, 27314, 62213, 31370, 45173, 7376, 8822, 44552, 49118, 6870, 23408, 48476, 8320, 12225, 9319, 23424, 38693, 9004, 20996, 7971, 6494, 2650, 2641, 2994, 28170, 21026, 21166, 354, 4751, 8838, 12230, 8821, 2600, 4421, 21411, 2316, 3439, 17855, 4472, 7898, 25594, 9017, 6264, 8512, 49241, 4405, 4717, 6554, 8673, 4722, 7645, 6573, 23432, 4629, 2510, 4769, 2701, 2401, 8816, 4630, 57713, 59069, 6496, 2678, 15440, 2636, 37210, 2402, 7778, 22077, 46874, 2625, 45035, 8677, 5892, 9276, 5064, 57077, 7676, 8952, 2430, 47147, 20971, 2687, 45116, 6593, 8244, 8495, 4495, 9318, 8542, 2598, 2640, 2699, 7512, 2734, 9283, 7798, 2667, 18414, 7804, 9101, 13375, 6882, 51809, 5642, 6571, 5182, 3716, 4584, 4762, 7368, 7849, 7348, 21001, 3739, 8385, 7733, 23120, 2417, 7675, 2536, 21593, 2773)
then 1 else 0 end as taxonomic
from events e join taggings tgs on e.id = tgs.taggable_id join tags t on tgs.tag_id = t.id
and e.created_locale = 'en-US'
and e.deleted_at is null
and e.status > 0
and tgs.created_by_staff_member = 1
--and e.created_at::date >= current_date - interval '365 days'
order by 1 desc
)
where taxonomic = 1
order by 1)
select e.id, e.total_signature_count from events e left join taxonomic_tagged tt on e.id = tt.petition_id
where tt.petition_id is null
and e.total_signature_count > 2
and e.deleted_at is null
and e.status > 0
and e.created_locale = 'en-US'
order by 2 desc
limit 999;